<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Digital Heritage 3D</title>
  
  <!-- Three.js + OBJ/MTL loaders -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.127.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.127.0/examples/js/loaders/OBJLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.127.0/examples/js/loaders/MTLLoader.js"></script>
  
</head>
<body>
  <h1>Digital Heritage 3D</h1>
  <p>Interactive 3D cultural objects with relevant information</p>

  <h2>Object data</h2>
  <div id="metadata"></div>

  <!-- create 3D viewer script-->
  <h2>3D Viewer</h2>
  <div id="viewer" style="width:600px; height:400px; border:1px solid #aaa;"></div> <!--Square viewer where object is displayed-->

  <script>
    document.addEventListener("DOMContentLoaded", () => {

      // create THREE.js Scene + Camera + Renderer
      const scene = new THREE.Scene();
      scene.background = new THREE.Color(0x222222);

      const camera = new THREE.PerspectiveCamera(75, 600/400, 0.1, 1000); //set camera perspective
      camera.position.z = 5;

      const renderer = new THREE.WebGLRenderer({antialias:true});
      renderer.setSize(600, 400);
      document.getElementById("viewer").appendChild(renderer.domElement);

      // Lights
      const light = new THREE.DirectionalLight(0xffffff, 1);
      light.position.set(1, 1, 1).normalize();
      scene.add(light);

      let loadedModel = null;

      // Load OBJ + MTL
      const mtlLoader = new THREE.MTLLoader();
      mtlLoader.setPath('../models/'); //find 3D model from /models
      mtlLoader.load('Armchair_mesh.mtl', (materials) => { // mtl for 3D object
        materials.preload();

        const objLoader = new THREE.OBJLoader();
        objLoader.setMaterials(materials);
        objLoader.setPath('../models/'); //find 3D model from /models
        objLoader.load('Armchair_mesh.obj', (object) => { // obj for 3D object
          object.scale.set(0.5,0.5,0.5);  // adjust size
          object.position.x = 0;       // offset to right
          scene.add(object);
          loadedModel = object;
        });
      });

      // Animate looping to show 3D object
      function animate() {
    requestAnimationFrame(animate);

        if(loadedModel) {
            loadedModel.rotation.y += 0.01; // rotate around Y-axis
        }

        renderer.render(scene, camera);
        }
      animate();

      // Load Metadata JSON
      fetch("http://localhost:3000/objects")
        .then(response => response.json())
        .then(data => {
          const container = document.getElementById("metadata");
          data.forEach(item => {
            container.innerHTML += `
              <h3>${item.title}</h3>
              <p><strong>Description:</strong> ${item.description}</p>
              <p><strong>Date:</strong> ${item.date}</p>
              <p><strong>Material:</strong> ${item.material}</p>
              <p><strong>Dimensions:</strong> ${item.dimensions}</p>
              <p><strong>Location Found:</strong> ${item.location_found}</p>
              <p><strong>Cultural Context:</strong> ${item.cultural_context}</p>
              <img src="${item.preview_image}" alt="Preview" style="max-width:200px;"/>
            `;
          });
        })
        .catch(err => console.error("Error loading JSON:", err)); //if error, message

    });
  </script>
</body>
</html>
